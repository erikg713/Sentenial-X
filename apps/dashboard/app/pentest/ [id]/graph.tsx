import React from "react";
import { notFound } from "next/navigation";
import { AttackGraph } from "@/components/AttackGraph";
import { get } from "@/lib/api";

// Types
interface Node {
  id: string;
  label?: string;
}

interface Link {
  source: string;
  target: string;
}

interface PentestGraphData {
  nodes: Node[];
  links: Link[];
}

// Server component: fetches data for this pentest graph
export default async function PentestGraphPage({
  params,
}: {
  params: { id: string };
}) {
  const { id } = params;

  let graphData: PentestGraphData;
  try {
    graphData = await get<PentestGraphData>(`/pentest/${id}/graph`);
  } catch (err) {
    return notFound();
  }

  if (!graphData?.nodes?.length) {
    return (
      <div className="p-6 text-center text-red-400">
        No graph data found for session <strong>{id}</strong>
      </div>
    );
  }

  return (
    <div className="p-6">
      <h1 className="text-2xl font-bold mb-4">Attack Graph: Session {id}</h1>
      <AttackGraph nodes={graphData.nodes} links={graphData.links} width={900} height={500} />
    </div>
  );
}

