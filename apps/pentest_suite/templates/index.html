<!DOCTYPE html>
<html>
<head>
  <title>Plugin Runner</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label { display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ðŸ§© Plugin Runner UI</h2>
  <select id="plugin-select"></select>
  <form id="plugin-form"></form>
  <button id="run-btn">Run Plugin</button>
  <pre id="output"></pre>

  <script>
    async function fetchPlugins() {
      const res = await fetch('/plugins');
      const plugins = await res.json();
      const select = document.getElementById('plugin-select');
      plugins.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });
      select.onchange = () => loadForm(select.value);
      loadForm(plugins[0]);
    }

    async function loadForm(pluginName) {
      const res = await fetch(`/plugins/${pluginName}/parameters`);
      const params = await res.json();
      const form = document.getElementById('plugin-form');
      form.innerHTML = '';
      params.forEach(p => {
        const label = document.createElement('label');
        label.textContent = p.label;

        let input;
        if (p.type === 'select') {
          input = document.createElement('select');
          p.choices.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.textContent = c;
            input.appendChild(opt);
          });
        } else if (p.type === 'bool') {
          input = document.createElement('input');
          input.type = 'checkbox';
          input.checked = p.default || false;
        } else {
          input = document.createElement('input');
          input.type = 'number';
          input.value = p.default;
          input.min = p.min;
          input.max = p.max;
        }

        input.name = p.name;
        label.appendChild(input);
        form.appendChild(label);
      });
    }

    document.getElementById('run-btn').onclick = async () => {
      const plugin = document.getElementById('plugin-select').value;
      const inputs = new FormData(document.getElementById('plugin-form'));
      const body = {};
      for (const [key, value] of inputs.entries()) {
        body[key] = value === "on" ? true : value;
      }
      const res = await fetch(`/plugins/${plugin}/run`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const result = await res.json();
      document.getElementById('output').textContent = JSON.stringify(result, null, 2);
    };

    fetchPlugins();
  </script>
</body>
</html>

